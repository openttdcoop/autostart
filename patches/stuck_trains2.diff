Index: src/rail_cmd.cpp
===================================================================
--- src/rail_cmd.cpp	(Revision 19045)
+++ src/rail_cmd.cpp	(Arbeitskopie)
@@ -2051,6 +2051,8 @@
 	RailGroundType old_ground = GetRailGroundType(tile);
 	RailGroundType new_ground;
 
+	ReduceStuckCounter(tile);
+
 	if (old_ground == RAIL_GROUND_WATER) {
 		TileLoop_Water(tile);
 		return;
Index: src/smallmap_gui.cpp
===================================================================
--- src/smallmap_gui.cpp	(Revision 19045)
+++ src/smallmap_gui.cpp	(Arbeitskopie)
@@ -211,6 +211,21 @@
 };
 assert_compile(lengthof(_map_height_bits) == MAX_TILE_HEIGHT + 1);
 
+/**
+ * Colour Coding for Stuck Counter
+ */
+static const uint32 _stuck_counter_colours[] = {
+	MKCOLOUR(0xD0D0D0D0),
+	MKCOLOUR(0xCECECECE),
+	MKCOLOUR(0xBFBFBFBF),
+	MKCOLOUR(0xBDBDBDBD),
+	MKCOLOUR(0xBABABABA),
+	MKCOLOUR(0xB8B8B8B8),
+	MKCOLOUR(0xB6B6B6B6),
+	MKCOLOUR(0xB4B4B4B4),
+};
+assert_compile(lengthof(_stuck_counter_colours) == 8);
+
 struct AndOr {
 	uint32 mor;
 	uint32 mand;
@@ -363,6 +378,12 @@
 		}
 	}
 
+	byte c = GetStuckCounter(tile);
+	if (t == MP_RAILWAY) {
+		if (c==0) return 0;
+		return _stuck_counter_colours[c/32];
+	}
+
 	/* Ground colour */
 	return ApplyMask(MKCOLOUR(0x54545454), &_smallmap_contours_andor[t]);
 }
Index: src/train_cmd.cpp
===================================================================
--- src/train_cmd.cpp	(Revision 19045)
+++ src/train_cmd.cpp	(Arbeitskopie)
@@ -3352,6 +3352,9 @@
 
 						/* Don't handle stuck trains here. */
 						if (HasBit(v->flags, VRF_TRAIN_STUCK)) return;
+						/* this codepath seems to be run every 5 ticks, so increase counter twice every 20 ticks */
+						IncreaseStuckCounter(v->tile);
+						if (v->tick_counter % 4 == 0) IncreaseStuckCounter(v->tile);
 
 						if (!HasSignalOnTrackdir(gp.new_tile, ReverseTrackdir(i))) {
 							v->cur_speed = 0;
@@ -3964,6 +3967,7 @@
 	/* Handle stuck trains. */
 	if (!mode && HasBit(v->flags, VRF_TRAIN_STUCK)) {
 		++v->wait_counter;
+		if (v->tick_counter % 4 == 0) IncreaseStuckCounter(v->tile);
 
 		/* Should we try reversing this tick if still stuck? */
 		bool turn_around = v->wait_counter % (_settings_game.pf.wait_for_pbs_path * DAY_TICKS) == 0 && _settings_game.pf.wait_for_pbs_path < 255;
Index: src/rail_map.h
===================================================================
--- src/rail_map.h	(Revision 19045)
+++ src/rail_map.h	(Arbeitskopie)
@@ -563,4 +563,27 @@
 	_me[t].m7 = 0;
 }
 
+
+static inline void IncreaseStuckCounter(TileIndex t)
+{
+	if (!IsTileType(t, MP_RAILWAY)) return;
+	if (_me[t].m7 == 255) return;
+	_me[t].m7++;
+}
+
+
+static inline void ReduceStuckCounter(TileIndex t)
+{
+	if (!IsTileType(t, MP_RAILWAY)) return;
+	_me[t].m7 -= _me[t].m7/4;
+}
+
+
+static inline byte GetStuckCounter(TileIndex t)
+{
+	if (!IsTileType(t, MP_RAILWAY)) return 0;
+	return _me[t].m7;
+
+}
+
 #endif /* RAIL_MAP_H */
